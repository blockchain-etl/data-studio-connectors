# Development environment setup

### Prerequisites
  - Install Node.js installed on your localhost. On MacOs you can install it using brew by running:
```brew install node```
  - [Enable the Apps Script API](https://script.google.com/home/usersettings)


### Setup

TODO: Figure out how to initialize dscc-gen using an existing project in order to get rid of steps 9 and 10 below. This should not be necessary.

1. Go to https://script.google.com/home
2. Create a new project by clicking on "New Project"
3. The App script editor UI opens up. Click. on File > Project Properties and copy the "Script ID".
4. Open a Terminal window and clone the repo: git clone git@github.com:blockchain-etl/data-studio-connectors.git
5. Got to the directory containing the connector code:
```cd data-studio-connectors/crypto-analytics```
6. Install the packages: npm install
7. Generate .configuration files for you local setup:
```npx @google/dscc-gen connector --script_id <SCRIPT_ID>```
8. It asks for a name. Use "dscc-config"
9. Copy the .clasps.json and file generated by dscc-gen to the source repository
```cp dscc-config/.clasps.json .```
10. Look for the "dsccConnector" section in file dscc-config/package.json. Copy the values for the fields "production" and "latest" values to the package.json in the repository. It should look like this:
```
  "dsccConnector": {
    "production": "<value>",
    "latest": "<value>"
  },
```

### Deploy the connector
```npm run push```
That will push the code to the App Script server.
You can check it worked by going to you App script editor UI and refresh. It should now have the code from the repo.

### Run the connector
```npm run try_latest```
You may get some warning about overwriting the manifest file. That's ok.
Then it should open a browser window with the connector loaded in Google Data Studio, asking got a GCP Project ID and a contract address.


## Misc links
  * [Local development setup](https://developers.google.com/datastudio/connector/local-development)
  * [create a new Apps Script project](https://medium.com/@bajena3/building-a-custom-google-data-studio-connector-from-a-z-part-1-basic-setup-445a6d965d3f)
